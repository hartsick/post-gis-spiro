<div id="map-canvas">
</div>

<script>
  // Display map
  var map;

  function initialize() {
    // set up map
    var mapOptions = {
      zoom: 6,
      center: {lat: 10, lng: 10}
    };
    map = new google.maps.Map(document.getElementById('map-canvas'),
        mapOptions);

    // start watching for movement
    watchID = navigator.geolocation.watchPosition(onSuccess, onError, options);
  }
  google.maps.event.addDomListener(window, 'load', initialize);


  // start monitoring location
  var watchID = false;
  var options = {    
    enableHighAccuracy: true,
    timeout: 10000,
    maximumAge: 5000
  };

  function onSuccess(position) {
    // create a new tracking point for user
    $.ajax({
        type: 'POST',
        url: '/user_locations',
        data: {
          lat: position.coords.latitude,
          lng: position.coords.longitude,
          accuracy: position.coords.accuracy,
          timestamp: position.timestamp,
          user_id: 2
        }
      });

    // prepare marker
    var markerLatlng = {lat: parseFloat(position.coords.latitude), lng: parseFloat(position.coords.longitude)};

    var marker = new google.maps.Marker({
      position: markerLatlng
    });

    // place marker and center
    marker.setMap(map);
    map.setCenter(markerLatlng);

    // log some junk
    console.log(markerLatlng);
    console.log(marker);
  }

  function onError(error){
    console.log('code: ' + error.code +
      ' | message: ' + error.message
    );
  }
</script>